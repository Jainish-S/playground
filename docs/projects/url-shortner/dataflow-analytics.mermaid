---
title: Analytics Data Flow Pipeline
---
flowchart LR
    subgraph Input["Data Capture"]
        Click["ğŸ–±ï¸ Click Event"]
        Meta["ğŸ“‹ Request Metadata<br/>â€¢ IP Address<br/>â€¢ User Agent<br/>â€¢ Referer<br/>â€¢ Timestamp"]
    end

    subgraph Enrichment["Data Enrichment"]
        Parse["ğŸ” Parse User Agent<br/>â€¢ Device Type<br/>â€¢ Browser<br/>â€¢ OS"]
        Geo["ğŸŒ GeoIP Lookup<br/>â€¢ Country<br/>â€¢ City<br/>â€¢ Coordinates"]
        Hash["ğŸ”’ Privacy Processing<br/>â€¢ Hash IP<br/>â€¢ Remove PII"]
    end

    subgraph Buffer["Buffer Layer"]
        RedisBuf["ğŸ”´ Redis List<br/>analytics:buffer<br/>~5000 events"]
    end

    subgraph Flush["Flush Worker"]
        Worker["âš™ï¸ Flusher<br/>Every 5 seconds<br/>Batch: 1000"]
    end

    subgraph Storage["Primary Storage"]
        Clicks["ğŸ“Š clicks<br/>(Hypertable)<br/>Raw Events"]
    end

    subgraph TimescaleFeatures["TimescaleDB Features"]
        Compress["ğŸ—œï¸ Compression<br/>After 7 days<br/>~90% reduction"]
        Retain["ğŸ—‘ï¸ Retention<br/>Drop after 90 days"]
    end

    subgraph Aggregation["Continuous Aggregates"]
        Hourly["â° hourly_stats<br/>Refresh: 30min"]
        Daily["ğŸ“… daily_stats<br/>Refresh: 1hr"]
    end

    subgraph Query["Query Layer"]
        Dashboard["ğŸ“ˆ Dashboard<br/>Queries"]
        Export["ğŸ“¤ Export<br/>Reports"]
        API["ğŸ”Œ Analytics<br/>API"]
    end

    %% Flow
    Click --> Meta
    Meta --> Parse
    Meta --> Geo
    Parse --> Hash
    Geo --> Hash
    Hash --> RedisBuf
    RedisBuf --> Worker
    Worker --> Clicks
    Clicks --> Compress
    Compress --> Retain
    Clicks --> Hourly
    Clicks --> Daily
    Hourly --> Dashboard
    Daily --> Dashboard
    Hourly --> API
    Daily --> API
    Clicks --> Export

    %% Styling
    style Click fill:#e3f2fd
    style RedisBuf fill:#ffebee
    style Clicks fill:#fff3e0
    style Hourly fill:#e8f5e9
    style Daily fill:#e8f5e9
