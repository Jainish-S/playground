---
title: URL Shortener - System Architecture
---
flowchart TB
    subgraph Clients["Client Layer"]
        Browser["ğŸŒ Web Browser"]
        Mobile["ğŸ“± Mobile App"]
        APIClient["ğŸ”Œ API Clients"]
    end

    subgraph CDN["CDN / Edge Layer"]
        CF["â˜ï¸ Cloudflare / Nginx"]
    end

    subgraph Frontend["Frontend Layer"]
        SvelteKit["âš¡ SvelteKit App<br/>(SSR + SPA)"]
        subgraph UIComponents["UI Components"]
            Dashboard["ğŸ“Š Dashboard"]
            URLManager["ğŸ”— URL Manager"]
            Analytics["ğŸ“ˆ Analytics Charts"]
        end
    end

    subgraph LoadBalancer["Load Balancer"]
        LB["âš–ï¸ Nginx / Traefik<br/>Rate Limiting<br/>SSL Termination"]
    end

    subgraph APILayer["API Layer (Go + fasthttp)"]
        API1["ğŸš€ API Server 1"]
        API2["ğŸš€ API Server 2"]
        API3["ğŸš€ API Server N"]
        
        subgraph Handlers["Request Handlers"]
            RedirectH["â†—ï¸ Redirect Handler"]
            URLH["ğŸ”— URL CRUD Handler"]
            AnalyticsH["ğŸ“Š Analytics Handler"]
            QRH["ğŸ“± QR Code Handler"]
            AuthH["ğŸ” Auth Handler"]
        end
        
        subgraph Services["Business Services"]
            ShortenerSvc["ğŸ”¢ Shortener Service"]
            AnalyticsSvc["ğŸ“ˆ Analytics Service"]
            GeoIPSvc["ğŸŒ GeoIP Service"]
            QRSvc["ğŸ“± QR Service"]
        end
    end

    subgraph Workers["Background Workers (Go)"]
        Flusher["ğŸ’¾ Analytics Flusher<br/>(Redis â†’ Postgres)"]
        AggRefresh["ğŸ“Š Aggregate Refresher"]
        GeoEnrich["ğŸŒ Geo Enrichment"]
    end

    subgraph Cache["Cache Layer"]
        Redis["ğŸ”´ Redis<br/>â€¢ URL Cache<br/>â€¢ Rate Limits<br/>â€¢ Analytics Buffer<br/>â€¢ QR Cache"]
    end

    subgraph Database["Database Layer"]
        subgraph PG["ğŸ˜ PostgreSQL + TimescaleDB"]
            Tables["ğŸ“‹ Regular Tables<br/>â€¢ users<br/>â€¢ urls<br/>â€¢ url_history<br/>â€¢ api_keys"]
            Hypertable["â±ï¸ Hypertable<br/>â€¢ clicks"]
            Aggregates["ğŸ“Š Continuous Aggregates<br/>â€¢ hourly_stats<br/>â€¢ daily_stats"]
        end
    end

    subgraph External["External Services"]
        MaxMind["ğŸŒ MaxMind GeoLite2<br/>(Local DB File)"]
    end

    %% Connections
    Browser --> CF
    Mobile --> CF
    APIClient --> CF
    
    CF --> SvelteKit
    CF --> LB
    
    SvelteKit --> LB
    
    LB --> API1
    LB --> API2
    LB --> API3
    
    API1 --> Redis
    API2 --> Redis
    API3 --> Redis
    
    API1 --> PG
    API2 --> PG
    API3 --> PG
    
    GeoIPSvc --> MaxMind
    
    Flusher --> Redis
    Flusher --> PG
    
    Workers -.-> Redis
    Workers -.-> PG

    %% Styling
    classDef clientStyle fill:#e1f5fe,stroke:#01579b
    classDef frontendStyle fill:#f3e5f5,stroke:#4a148c
    classDef apiStyle fill:#e8f5e9,stroke:#1b5e20
    classDef cacheStyle fill:#ffebee,stroke:#b71c1c
    classDef dbStyle fill:#fff3e0,stroke:#e65100
    classDef workerStyle fill:#fce4ec,stroke:#880e4f
    
    class Browser,Mobile,APIClient clientStyle
    class SvelteKit,Dashboard,URLManager,Analytics frontendStyle
    class API1,API2,API3,RedirectH,URLH,AnalyticsH,QRH,AuthH apiStyle
    class Redis cacheStyle
    class PG,Tables,Hypertable,Aggregates dbStyle
    class Flusher,AggRefresh,GeoEnrich workerStyle
